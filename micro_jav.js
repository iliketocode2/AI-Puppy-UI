/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/micro-repl@0.5.0/serial.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
const e="\r\n",t=`${e}>>> `,n=/(?:\r\n|\r|\n)/,r=["from sys import implementation as _",'print(hasattr(_, "_machine") and _._machine or _.name)',"del _",e].join(";"),o="https://cdn.jsdelivr.net/npm",a="5.3.0",{assign:i}=Object,{parse:s}=JSON,c=e=>t=>e.write(t),d=async(e,t,r=[])=>{for(const o of e.split(n))r.push(o),await t.write(`${o}\r`),await w(10)},l=()=>{},u=e=>new Error(`Unable to ${e} when disconnected`),w=async e=>new Promise((t=>setTimeout(t,e))),m=(e,t,n)=>"infer"===t?getComputedStyle(e).getPropertyValue(n):t,p={baudRate:115200,dataType:"buffer",onconnect:l,ondisconnect:l,onerror:console.error,ondata:l,theme:{background:"#191A19",foreground:"#F5F2E7"}};function f({baudRate:n=p.baudRate,dataType:l=p.dataType,onconnect:y=p.onconnect,ondisconnect:h=p.ondisconnect,onerror:b=p.onerror,ondata:g=p.ondata,onresult:$=s,theme:k=p.theme}=p){let _,T,v,x,A,D=0,E=!1,K=null,R=null,S=null,j="unknown",P="";const W=()=>P.split(e).at(-2),F={__proto__:f.prototype,get connected(){return!!K},get baudRate(){return n},get name(){return j},get terminal(){return R},connect:async e=>{if(K)return F;"string"==typeof e&&(e=document.getElementById(e)||document.querySelector(e));try{const s=(({ownerDocument:e})=>{const t="stylesheet",n=`${o}/xterm@${a}/css/xterm.min.css`,r=`link[rel="${t}"][href="${n}"]`;return e.querySelector(r)||e.head.append(i(e.createElement("link"),{rel:t,href:n})),[import(`${o}/codedent@0.1.2/+esm`),import(`${o}/xterm@${a}/+esm`),import(`${o}/@xterm/addon-fit@0.10.0/+esm`),import(`${o}/@xterm/addon-web-links@0.11.0/+esm`)]})(e);S=e,K=await navigator.serial.requestPort();const[{default:u},{Terminal:f},{FitAddon:h},{WebLinksAddon:b}]=await Promise.all(s.concat(K.open({baudRate:n}))),{background:$,foreground:q}=k,B=m(e,q,"color"),C=m(e,$,"background-color");T=u,R=new f({cursorBlink:!0,cursorStyle:"block",theme:{cursor:B,foreground:B,selectionForeground:C,background:C,selectionBackground:B}});const O=new TextEncoderStream;A=O.readable.pipeTo(K.writable),x=O.writable.getWriter();const V=new TextDecoder,z=Promise.withResolvers();let H=!1;const I=e=>{g("string"===l?V.decode(e):e),R.write(e)},J=new WritableStream({write:c({write(e){D?1<D?P+=V.decode(e):E&&I(e):H?(P+=V.decode(e),P.endsWith(t)&&P.includes(r)&&(z.resolve(W()),P="")):I(e)}})});_=new AbortController,v=K.readable.pipeTo(J,_).catch((()=>{K&&F.disconnect()}));let L=!1;R.attachCustomKeyEventHandler((e=>{const{type:t,code:n,composed:r,ctrlKey:o,shiftKey:a}=e;if("keydown"===t)if(r&&o&&!a){if(L)L="KeyD"!==n;else if("KeyE"===n)L=!0;else if("KeyD"===n)return e.preventDefault(),F.reset(),!1}else if(L&&r&&o&&a&&"KeyV"===n)return e.preventDefault(),navigator.clipboard.readText().then((e=>d(e,x))),!1;return!0})),R.onData(c(x));const M=new h;return R.loadAddon(M),R.loadAddon(new b),R.open(e),M.fit(),R.focus(),await x.write(""),await w(50*p.baudRate/n),H=!0,await x.write(""),await x.write(r),await x.write(""),j=await z.promise,H=!1,R.write("[M"),R.write(`${j}${t}`),y(),F}catch(e){K=null,b(e)}},disconnect:async()=>{if(K){const e=K,t=R;K=null,R=null;try{_.abort("disconnect"),x.close(),await A,await v,await e.close(),t.dispose()}finally{h()}}},eval:async(n,{hidden:r=!0}={})=>{if(K){let o;D=1,E=!r;const a=[];for(await d(T(n),x,a);a.length&&!a.at(-1).trim();)a.pop();const i=a.at(-1);if(/^[a-zA-Z0-9._]+$/.test(i)){for(await x.write(`import json;print(json.dumps(${i}))${e}`),D=2;!P.endsWith(t);)await w(1);try{o=$(W())}finally{P=""}}return D=0,E=!1,o}b(u("eval"))},paste:async(e,{hidden:t=!0}={})=>{K?(D=1,E=!t,await x.write(""),await d(T(e),x),await x.write(""),D=0,E=!1):b(u("paste"))},reset:async(e=500)=>{if(K){for(await x.write("");K&&(await w(e),K&&/\n $/.test(S.innerText));)await x.write("");R.focus()}else b(u("reset"))},write:async e=>{K?await x.write(e):b(u("write"))}};return F}export{f as default};
//# sourceMappingURL=/sm/20bf3c3b5b7341c9feb57b134aec0954c6808464559b00f5dceb37e766e0f58f.map